<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üéÆ –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/parse/dist/parse.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding-top: 40px;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 20px;
    }
    .menu {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 250px;
      margin: auto;
    }
    .menu a {
      display: block;
      padding: 15px;
      background: #222;
      color: #fff;
      text-decoration: none;
      font-size: 18px;
      border-radius: 8px;
      transition: background 0.3s;
    }
    .menu a:hover {
      background: #ff4444;
    }
    #balance {
      margin-top: 20px;
      font-size: 18px;
    }
    #topup {
      margin-top: 10px;
    }
    input, button {
      padding: 8px;
      font-size: 16px;
      margin: 5px;
      border: none;
      border-radius: 5px;
    }
    button {
      background: #44aa44;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000a; z-index:999; justify-content:center; align-items:center;">
  <div style="background:#222; padding:20px; border-radius:10px; width:90%; max-width:300px;">
    <h2>üí∏ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON</h2>
    <input type="number" id="modalAmount" placeholder="–°—É–º–º–∞ TON" min="0.01" step="0.01" style="width:100%; margin-bottom:10px;">
    <button onclick="confirmTopUp()">‚úÖ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
    <button onclick="closeModal()" style="background:#aa4444; margin-top:10px;">‚ùå –û—Ç–º–µ–Ω–∞</button>
    <div id="modalStatus" style="margin-top:10px;"></div>
  </div>
  </div>
  <div class="container">
    <div id="ton-connect-button"></div>
    <h1>üéÆ –í—ã–±–µ—Ä–∏ –∏–≥—Ä—É</h1>
    <div class="menu">
      <a href="mines.html">üí£ –ú–∏–Ω—ã</a>
      <a href="crash.html">üöÄ Crash</a>
      <a href="777.html">üé∞ –†—É–ª–µ—Ç–∫–∞</a>
    </div>

    <div id="balance">–ë–∞–ª–∞–Ω—Å: 0 Ton</div>
    
  </div>
  <button onclick="openModal()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ TON</button>

   <h2>üì§ –ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥</h2>
<div id="withdraw">
  <input type="text" id="withdrawAddress" placeholder="TON-–∞–¥—Ä–µ—Å" style="width:90%">
  <input type="number" id="withdrawAmount" placeholder="–°—É–º–º–∞ TON" min="1" style="width:90%">
  <button onclick="submitWithdrawal()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
</div>
<div id="withdrawStatus"></div>
  
<script>
  Parse.initialize("D0jI4TXxRawLDpR9lCNdMqYMRpfm30ibbpvvnXZy", "gklqNlqFb1Hm4dd1MoUWFsrcX4gQtMsMGMqnmZjn");
  Parse.serverURL = "https://parseapi.back4app.com";

async function submitWithdrawal() {
  const address = document.getElementById("withdrawAddress").value.trim();
  const amount = parseFloat(document.getElementById("withdrawAmount").value);
  const statusEl = document.getElementById("withdrawStatus");

  const localBalance = parseFloat(localStorage.getItem('balance')) || 0;

  if (!address || address.length < 1 || isNaN(amount) || amount < 1) {
    statusEl.textContent = "‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ";
    return;
  }

  if (localBalance < amount) {
    statusEl.textContent = `‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ë–∞–ª–∞–Ω—Å: ${localBalance.toFixed(2)} TON`;
    return;
  }

  try {
    const response = await Parse.Cloud.run("submitWithdrawal", {
      address,
      amount
    });

    const newBalance = localBalance - amount;
    localStorage.setItem('balance', newBalance);
    document.getElementById('balance').textContent = `–ë–∞–ª–∞–Ω—Å: ${newBalance.toFixed(2)} TON`;

    statusEl.textContent = response;
    document.getElementById("withdrawAddress").value = '';
    document.getElementById("withdrawAmount").value = '';
  } catch (err) {
    statusEl.textContent = err.message || '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏';
    console.error(err);
  }
      }
</script>

   <script>
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: 'https://phenomenal-bubblegum-d6b71e.netlify.app/tonconnect-manifest.json',
      buttonRootId: 'ton-connect-button'
    });

    const recipientAddress = "EQDYXMQCS9pzb_9oFiJjV97si_kNZwh0TU-0UtmFG-bHlqGf";
    let balance = parseFloat(localStorage.getItem('balance')) || 0;

    function updateBalance() {
      document.getElementById('balance').textContent = `–ë–∞–ª–∞–Ω—Å: ${balance} Ton`;
      localStorage.setItem('balance', balance);
    }

    async function sendTon() {
      const amount = parseInt(document.getElementById('topupAmount').value);
      if (!amount || amount < 1) return;

      const wallet = tonConnectUI.wallet;
      if (!wallet) {
        alert('‚ùå –ö–æ—à–µ–ª—ë–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
        return;
      }

      const transaction = {
        validUntil: Math.floor(Date.now() / 1000) + 60,
        messages: [
          {
            address: recipientAddress,
            amount: (amount * 1e9).toString()
          }
        ]
      };

      try {
        await tonConnectUI.sendTransaction(transaction);
        balance += amount;
        updateBalance();
        alert(`‚úÖ –ü–æ–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ ${amount} TON`);
        document.getElementById('topupAmount').value = '';
      } catch (e) {
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ TON');
        console.error(e);
      }
    }

    updateBalance();
   </script>
  <script>
function openModal() {
  document.getElementById('modal').style.display = 'flex';
  document.getElementById('modalAmount').value = '';
  document.getElementById('modalStatus').textContent = '';
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
}

async function confirmTopUp() {
  const amount = parseFloat(document.getElementById('modalAmount').value);
  const statusEl = document.getElementById('modalStatus');

  if (!amount || amount < 0.01) {
    statusEl.textContent = '‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –æ—Ç 0.01 TON';
    return;
  }

  const wallet = tonConnectUI.wallet;
  if (!wallet) {
    statusEl.textContent = '‚ùå –ö–æ—à–µ–ª—ë–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω';
    return;
  }

  const transaction = {
    validUntil: Math.floor(Date.now() / 1000) + 60,
    messages: [
      {
        address: recipientAddress,
        amount: (amount * 1e9).toString()
      }
    ]
  };

  try {
    await tonConnectUI.sendTransaction(transaction);
    balance += amount;
    balance = parseFloat(balance.toFixed(2));
    updateBalance();
    statusEl.textContent = `‚úÖ –ü–æ–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ ${amount.toFixed(2)} TON`;
    setTimeout(closeModal, 1500);
  } catch (e) {
    statusEl.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ TON';
    console.error(e);
  }
}
  </script>
</body>
</html>
