<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding-top: 40px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px;
      border: none;
      border-radius: 5px;
      width: 80%;
    }
    button {
      background: #44aa44;
      color: white;
      cursor: pointer;
    }
    #status {
      margin-top: 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h1>
  <div id="ton-connect-button"></div>
  <input type="number" id="topupAmount" placeholder="–°—É–º–º–∞ TON" min="0.01" step="0.01">
  <button onclick="sendTon()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
  <div id="status"></div>

  <script>
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: 'https://phenomenal-bubblegum-d6b71e.netlify.app/tonconnect-manifest.json',
      buttonRootId: 'ton-connect-button'
    });

    const recipientAddress = "EQDYXMQCS9pzb_9oFiJjV97si_kNZwh0TU-0UtmFG-bHlqGf";

    async function sendTon() {
      const amount = parseFloat(document.getElementById('topupAmount').value);
      const statusEl = document.getElementById('status');

      if (!amount || amount < 0.01) {
        statusEl.textContent = '‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –æ—Ç 0.01 TON';
        return;
      }

      const wallet = tonConnectUI.wallet;
      if (!wallet || !wallet.account?.address) {
        statusEl.textContent = '‚ùå –ö–æ—à–µ–ª—ë–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω';
        return;
      }

      const transaction = {
        validUntil: Math.floor(Date.now() / 1000) + 60,
        messages: [
          {
            address: recipientAddress,
            amount: (amount * 1e9).toString()
          }
        ]
      };

      try {
        await tonConnectUI.sendTransaction(transaction);

        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
        const currentBalance = parseFloat(localStorage.getItem('balance')) || 0;
        const newBalance = parseFloat((currentBalance + amount).toFixed(2));
        localStorage.setItem('balance', newBalance);

        statusEl.textContent = `‚úÖ –ü–æ–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ ${amount.toFixed(2)} TON. –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${newBalance.toFixed(2)} TON`;
        document.getElementById('topupAmount').value = '';
      } catch (e) {
        statusEl.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ TON';
        console.error(e);
      }
    }
  </script>
</body>
</html>
